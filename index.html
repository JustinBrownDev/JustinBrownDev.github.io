<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets API Example</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        // Global variable to keep track of whether the client is initialized
        let isGapiClientLoaded = false;

        // Load the Google API client library and initialize the API
        function loadClient() {
            gapi.load("client:auth2", initClient);
        }

        // Initialize the client with the API key and discovery docs
        function initClient() {
            gapi.client.init({
                apiKey: 'AIzaSyDoBXAnxhZjd6F0pqkKsD1uU9G1Hlh2mTc', // Replace with your API key
                discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
                scope: "https://www.googleapis.com/auth/spreadsheets.readonly" // Adjust scope if needed
            }).then(function () {
                console.log("GAPI client loaded for API");
                isGapiClientLoaded = true; // Set flag to true once API is ready
            }, function(error) {
                console.error("Error loading GAPI client for API", error);
            });
        }

        // Fetch data from the specified Google Sheet
        function getSheetData() {
            if (!isGapiClientLoaded) {
                alert("API client is not fully loaded yet. Please try again in a few seconds.");
                return;
            }

            const spreadsheetId = '1KFOoEyzY5r6-hyeLrp4mQfHCDQrjURgFI1nw0oFCX-k'; // Replace with your Spreadsheet ID
            const range = 'Sheet1!A1:B10'; // Adjust as needed

            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: spreadsheetId,
                range: range
            }).then(function(response) {
                const data = response.result.values;
                if (data && data.length > 0) {
                    let output = '<table border="1">';
                    data.forEach(row => {
                        output += '<tr>';
                        row.forEach(cell => {
                            output += `<td>${cell}</td>`;
                        });
                        output += '</tr>';
                    });
                    output += '</table>';
                    document.getElementById('content').innerHTML = output;
                } else {
                    document.getElementById('content').innerHTML = "No data found.";
                }
            }, function(error) {
                console.error("Error fetching data from Sheets API", error);
                document.getElementById('content').innerHTML = "Error fetching data.";
            });
        }
    </script>
</head>
<body onload="loadClient()">
    <h1>Google Sheets API Example</h1>
    <button onclick="getSheetData()">Get Sheet Data</button>
    <div id="content"></div>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Button Presses to Google Sheets</title>
    <script src="https://cdn.jsdelivr.net/npm/jsrsasign@10.5.23/lib/jsrsasign-all-min.js"></script> <!-- For JWT creation -->
    <script>
        const serviceAccountEmail = 'sheets-api@rent-with-jacob.iam.gserviceaccount.com'; // Replace with your service account email
        const privateKey = 'AIzaSyDoBXAnxhZjd6F0pqkKsD1uU9G1Hlh2mTc'; // Replace with your private key
        const spreadsheetId = '1KFOoEyzY5r6-hyeLrp4mQfHCDQrjURgFI1nw0oFCX-k'; // Replace with your spreadsheet ID
        const scope = 'https://www.googleapis.com/auth/spreadsheets';

        // JWT Generation Function
        function generateJWT() {
            const header = {
                alg: "RS256",
                typ: "JWT"
            };

            const now = Math.floor(Date.now() / 1000);
            const payload = {
                iss: serviceAccountEmail,
                scope: scope,
                aud: "https://oauth2.googleapis.com/token",
                iat: now,
                exp: now + 3600,
            };

            const jwt = KJUR.jws.JWS.sign(
                null,
                JSON.stringify(header),
                JSON.stringify(payload),
                privateKey
            );

            return jwt;
        }

        // Function to get Access Token using JWT
        async function getAccessToken() {
            const jwt = generateJWT();

            const response = await fetch('https://oauth2.googleapis.com/token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({
                    grant_type: 'urn:ietf:params:oauth:grant-type:jwt-bearer',
                    assertion: jwt
                })
            });

            const data = await response.json();
            return data.access_token;
        }

        // Function to log button press to Google Sheets
        async function logButtonPress(buttonId) {
            const accessToken = await getAccessToken();

            const range = 'Sheet1!A:B'; // The range where you want to log the button press
            const timestamp = new Date().toISOString();
            const values = [[timestamp, buttonId]];

            const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}:append?valueInputOption=USER_ENTERED`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    values: values
                })
            });

            const result = await response.json();
            console.log('Button press logged:', result);
        }
    </script>
</head>
<body>
    <h1>Log Button Presses to Google Sheets</h1>
    <button onclick="logButtonPress('Button1')">Button 1</button>
    <button onclick="logButtonPress('Button2')">Button 2</button>
</body>
</html>
